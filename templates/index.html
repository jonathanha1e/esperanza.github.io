<!-- templates/index.html -->
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Herramienta de Inmigración</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <div class="container">
    <div id="introContent" data-md="{{ url_for('serve_markdown', filename='intro.md') }}"></div>
    <a id="faqBtn" href="/faq" class="button-link">❓ Preguntas Frecuentes</a>

    <!-- Hidden flow sections -->
    <div id="questionBox" class="hidden">
      <h2 id="questionText"></h2>
      <button id="yesBtn">✅ Sí</button>
      <button id="noBtn">❌ No</button>
      <button id="notSureBtn">🤔 No estoy seguro</button>
      <div id="questionMarkdown" class="question-md"></div>
    </div>

    <div id="outcomeBox" class="hidden">
      <h2 id="pageHeading" class="mb-4"></h2>
      <p id="outcomeText"></p>
      <a id="outcomeLink" href="#" target="_blank" class="button-link hidden">🔗 Buscar su información</a>
      <button id="nextBtn" class="hidden">➡️ Siguiente</button>
    </div>

    <div id="hearingDateBox" class="hidden">
      <h2 id="hearingPrompt"></h2>
      <input type="date" id="hearingDate">
      <button id="calculateBtn">🗓️ Calcular</button>
      <div id="warning-container"></div>
      <div id="hearingResult"></div>
      <div id="hearingMarkdown" class="hearing-md"></div>
    </div>

    <div class="nav-buttons hidden" id="navButtons">
      <button id="backBtn">🔙 Atrás</button>
      <button id="hearBtn">🔊 Escuchar</button>
      <button id="restartBtn">🔁 Empezar de nuevo</button>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="{{ url_for('static', filename='script.js') }}"></script>
  <script>
    const container = document.getElementById("introContent");
    fetch(container.dataset.md)
      .then(res => res.text())
      .then(md => {
        container.innerHTML = marked.parse(md);
        const startBtn = document.getElementById("startBtn");
        if (startBtn) {
          startBtn.onclick = () => {
            container.classList.add("hidden");
            document.getElementById("faqBtn").classList.add("hidden");
            document.getElementById("questionBox").classList.remove("hidden");
            document.getElementById("navButtons").classList.remove("hidden");
            renderStep(currentStep);
          };
        }
      })
      .catch(() => {
        container.innerHTML = "<p>Error al cargar la introducción.</p>";
      });
  </script>
</body>
</html>
